<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <!-- Font Awesome - pastikan menggunakan versi terbaru -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Alpine.js -->
    <script src="https://unpkg.com/alpinejs@3.12.0/dist/cdn.min.js" defer></script>
    <!-- Main CSS -->
    <link rel="stylesheet" href="/static/css/botopia.css">
</head>
<body class="u-bg-slate-900 u-text-white">
    <div class="l-app-container" x-data="{ sidebarOpen: false }">
        <!-- Sidebar -->
        {{template "partials/sidebar" .}}
        
        <!-- Main content -->
        <main class="l-content-with-sidebar" :class="{'sidebar-collapsed': $store.sidebar.collapsed}">
            <!-- Header -->
            {{template "partials/header" .}}
            
            <!-- Content area -->
            <div class="l-content">
                {{embed}}
            </div>
            
            <!-- Footer -->
            {{template "partials/footer" .}}
        </main>
    </div>

    <!-- Mobile sidebar backdrop -->
    <div class="l-sidebar-backdrop" @click="$store.sidebar.closeMobileMenu()" :class="{ 'active': $store.sidebar.mobileOpen }"></div>
    
    <!-- Toast container for notifications -->
    <div id="toast-container" class="p-toast-container"></div>

    <!-- Main JavaScript -->
    <script src="/static/js/utils/toast.js"></script>
    <script src="/static/js/sidebar-controller.js"></script>
    <script src="/static/js/main.js"></script>
    
    <!-- Alpine.js Store for Sidebar State -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.store('sidebar', {
                collapsed: localStorage.getItem('sidebarCollapsed') === 'true',
                mobileOpen: false,
                
                toggleCollapse() {
                    this.collapsed = !this.collapsed;
                    localStorage.setItem('sidebarCollapsed', this.collapsed);
                },
                
                toggleMobileMenu() {
                    this.mobileOpen = !this.mobileOpen;
                },
                
                closeMobileMenu() {
                    this.mobileOpen = false;
                }
            });
        });
    </script>
    
    <!-- Page specific script -->
    {{if eq .Page "dashboard"}}
    <script src="/static/js/pages/dashboard-app.js"></script>
    {{else if eq .Page "qr"}}
    <script src="/static/js/pages/qr-app.js"></script>
    {{else if eq .Page "commands"}}
    <script src="/static/js/pages/commands-app.js"></script>
    {{else if eq .Page "data-master"}}
    <script src="/static/js/pages/data-master-app.js"></script>
    {{else if eq .Page "contacts"}}
    <script src="/static/js/pages/contact-app.js"></script>
    {{end}}

    <!-- Script untuk debug popular commands -->
    <script>
        // Debug function that will run after page loads
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                console.log("Commands from window object:", window.botopiaCommands);
                if (window.Alpine) {
                    const dashApp = document.querySelector('[x-data="dashboardApp"]')?.__x;
                    if (dashApp) {
                        console.log("Popular commands from Alpine:", dashApp.$data.popularCommands);
                    }
                }
            }, 1000);
        });
    </script>
</body>
</html>
