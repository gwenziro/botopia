<div class="p-contacts" x-data="contactsApp" x-init="initialize">
    <!-- Page Header -->
    <div class="p-contacts-header">
        <div class="p-contacts-header__title">
            <i class="fas fa-address-book u-text-primary-400"></i>
            <h2>Kontak & Whitelist</h2>
        </div>
        <div class="p-contacts-header__actions">
            <button class="c-button c-button--primary c-button--with-icon" @click="openAddModal">
                <i class="fas fa-plus"></i>
                <span>Tambah Kontak</span>
            </button>
        </div>
    </div>
    
    <!-- Whitelist Toggle Card -->
    <div class="c-status-card" :class="{'c-status-card--active': useWhitelist, 'c-status-card--inactive': !useWhitelist}">
        <div class="c-status-card__content">
            <div class="c-status-card__icon">
                <i class="fas" :class="useWhitelist ? 'fa-shield-alt' : 'fa-shield-alt'"></i>
            </div>
            <div class="c-status-card__info">
                <h3 class="c-status-card__title">
                    Mode Whitelist <span x-text="useWhitelist ? 'Aktif' : 'Nonaktif'" class="c-status-badge" :class="{'c-status-badge--active': useWhitelist, 'c-status-badge--inactive': !useWhitelist}"></span>
                </h3>
                <p class="c-status-card__description">
                    <template x-if="useWhitelist">
                        Bot hanya akan merespon pesan dari kontak yang masuk dalam daftar whitelist.
                    </template>
                    <template x-if="!useWhitelist">
                        Bot akan merespon semua pesan tanpa memperhatikan whitelist.
                    </template>
                </p>
            </div>
        </div>
        <div class="c-status-card__action">
            <button class="c-toggle-button" @click="toggleWhitelist" :class="{'c-toggle-button--active': useWhitelist}">
                <span class="c-toggle-button__slider"></span>
                <span class="c-toggle-button__text" x-text="useWhitelist ? 'Aktif' : 'Nonaktif'"></span>
            </button>
        </div>
    </div>
    
    <!-- Filters and Search -->
    <div class="p-contacts-toolbar">
        <div class="p-contacts-search">
            <i class="fas fa-search p-contacts-search__icon"></i>
            <input type="text" x-model="searchQuery" class="p-contacts-search__input" placeholder="Cari kontak...">
            <button class="p-contacts-search__clear" x-show="searchQuery" @click="resetSearch">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="p-contacts-filter">
            <select class="c-select" x-model="filterType">
                <option value="all">Semua Kontak</option>
                <option value="whitelist">Hanya Whitelist</option>
                <option value="regular">Non-Whitelist</option>
            </select>
        </div>
    </div>
    
    <!-- Loading State -->
    <div class="c-loading" x-show="loading">
        <div class="c-loading__spinner"></div>
        <p class="c-loading__text">Memuat daftar kontak...</p>
    </div>
    
    <!-- Contacts List -->
    <div class="p-contacts-list" x-show="!loading">
        <!-- Empty State -->
        <template x-if="filteredContacts.length === 0">
            <div class="p-empty-state">
                <div class="p-empty-state__icon">
                    <i class="fas fa-address-card"></i>
                </div>
                <h3 class="p-empty-state__title">Tidak ada kontak</h3>
                <p class="p-empty-state__text">
                    <template x-if="searchQuery">
                        Tidak ada kontak yang cocok dengan pencarian Anda.
                    </template>
                    <template x-if="!searchQuery">
                        Belum ada kontak yang tersimpan. Tambahkan kontak untuk mulai menggunakan fitur whitelist.
                    </template>
                </p>
                <template x-if="searchQuery">
                    <button class="c-button c-button--secondary c-button--sm" @click="resetSearch">
                        <i class="fas fa-times"></i> Reset Pencarian
                    </button>
                </template>
            </div>
        </template>
        
        <!-- Contact Cards -->
        <template x-for="contact in filteredContacts" :key="contact.phone">
            <div class="c-contact-card" :class="{'c-contact-card--whitelisted': contact.whitelisted}">
                <div class="c-contact-card__avatar">
                    <template x-if="contact.whitelisted">
                        <div class="c-contact-card__badge">
                            <i class="fas fa-check"></i>
                        </div>
                    </template>
                    <span x-text="getInitials(contact.name)"></span>
                </div>
                <div class="c-contact-card__content">
                    <h3 class="c-contact-card__name" x-text="contact.name"></h3>
                    <p class="c-contact-card__phone" x-text="formatPhone(contact.phone)"></p>
                    <template x-if="contact.notes">
                        <p class="c-contact-card__notes" x-text="contact.notes"></p>
                    </template>
                </div>
                <div class="c-contact-card__actions">
                    <button class="c-icon-btn" @click="toggleWhitelistStatus(contact)" :title="contact.whitelisted ? 'Hapus dari Whitelist' : 'Tambah ke Whitelist'">
                        <i class="fas" :class="contact.whitelisted ? 'fa-shield-alt c-icon--success' : 'fa-shield-alt c-icon--muted'"></i>
                    </button>
                    <button class="c-icon-btn" @click="openEditModal(contact)" title="Edit Kontak">
                        <i class="fas fa-edit c-icon--primary"></i>
                    </button>
                    <button class="c-icon-btn" @click="openDeleteModal(contact)" title="Hapus Kontak">
                        <i class="fas fa-trash-alt c-icon--danger"></i>
                    </button>
                </div>
            </div>
        </template>
    </div>
    
    <!-- Add Contact Modal -->
    <div class="c-modal" :class="{'c-modal--active': showAddModal}">
        <div class="c-modal__overlay" @click="showAddModal = false"></div>
        <div class="c-modal__container">
            <div class="c-modal__header">
                <div class="c-modal__title-group">
                    <i class="fas fa-user-plus c-modal__icon"></i>
                    <h3 class="c-modal__title">Tambah Kontak Baru</h3>
                </div>
                <button class="c-modal__close" @click="showAddModal = false">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="c-modal__body">
                <form @submit.prevent="addContact" class="c-form">
                    <div class="c-form-group">
                        <label class="c-form-label" for="contact-name">
                            <i class="fas fa-user c-form-icon"></i> Nama
                        </label>
                        <input type="text" id="contact-name" class="c-form-input" 
                               x-model="newContact.name" placeholder="Nama kontak" required>
                    </div>
                    
                    <div class="c-form-group">
                        <label class="c-form-label" for="contact-phone">
                            <i class="fas fa-phone c-form-icon"></i> Nomor Telepon
                        </label>
                        <div class="c-form-input-group">
                            <div class="c-form-input-prefix">+</div>
                            <input type="text" id="contact-phone" class="c-form-input c-form-input--with-prefix" 
                                   x-model="newContact.phone" placeholder="628123456789" required>
                        </div>
                        <small class="c-form-help">Masukkan nomor tanpa spasi (contoh: 628123456789)</small>
                    </div>
                    
                    <div class="c-form-group">
                        <label class="c-form-label" for="contact-notes">
                            <i class="fas fa-sticky-note c-form-icon"></i> Catatan (opsional)
                        </label>
                        <textarea id="contact-notes" class="c-form-textarea" 
                                  x-model="newContact.notes" placeholder="Tambahkan catatan..."></textarea>
                    </div>
                    
                    <div class="c-form-group">
                        <div class="c-form-switch">
                            <input type="checkbox" id="contact-whitelist" class="c-form-switch__input" x-model="newContact.whitelisted">
                            <label for="contact-whitelist" class="c-form-switch__label">
                                <span class="c-form-switch__slider"></span>
                                <span class="c-form-switch__text">Tambahkan ke whitelist</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="c-form-footer">
                        <button type="button" class="c-button c-button--secondary" @click="showAddModal = false">Batal</button>
                        <button type="submit" class="c-button c-button--primary">
                            <i class="fas fa-save"></i> Simpan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Edit Contact Modal -->
    <div class="c-modal" :class="{'c-modal--active': showEditModal}">
        <div class="c-modal__overlay" @click="showEditModal = false"></div>
        <div class="c-modal__container">
            <div class="c-modal__header">
                <div class="c-modal__title-group">
                    <i class="fas fa-user-edit c-modal__icon"></i>
                    <h3 class="c-modal__title">Edit Kontak</h3>
                </div>
                <button class="c-modal__close" @click="showEditModal = false">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="c-modal__body">
                <form @submit.prevent="updateContact" class="c-form">
                    <div class="c-form-group">
                        <label class="c-form-label" for="edit-contact-name">
                            <i class="fas fa-user c-form-icon"></i> Nama
                        </label>
                        <input type="text" id="edit-contact-name" class="c-form-input" 
                               x-model="editContact.name" placeholder="Nama kontak" required>
                    </div>
                    
                    <div class="c-form-group">
                        <label class="c-form-label" for="edit-contact-phone">
                            <i class="fas fa-phone c-form-icon"></i> Nomor Telepon
                        </label>
                        <div class="c-form-input-group">
                            <div class="c-form-input-prefix">+</div>
                            <input type="text" id="edit-contact-phone" class="c-form-input c-form-input--with-prefix" 
                                   x-model="editContact.phone" placeholder="628123456789" disabled>
                        </div>
                        <small class="c-form-help">Nomor telepon tidak dapat diubah</small>
                    </div>
                    
                    <div class="c-form-group">
                        <label class="c-form-label" for="edit-contact-notes">
                            <i class="fas fa-sticky-note c-form-icon"></i> Catatan (opsional)
                        </label>
                        <textarea id="edit-contact-notes" class="c-form-textarea" 
                                  x-model="editContact.notes" placeholder="Tambahkan catatan..."></textarea>
                    </div>
                    
                    <div class="c-form-group">
                        <div class="c-form-switch">
                            <input type="checkbox" id="edit-contact-whitelist" class="c-form-switch__input" x-model="editContact.whitelisted">
                            <label for="edit-contact-whitelist" class="c-form-switch__label">
                                <span class="c-form-switch__slider"></span>
                                <span class="c-form-switch__text">Tambahkan ke whitelist</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="c-form-footer">
                        <button type="button" class="c-button c-button--secondary" @click="showEditModal = false">Batal</button>
                        <button type="submit" class="c-button c-button--primary">
                            <i class="fas fa-save"></i> Simpan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Delete Contact Modal -->
    <div class="c-modal" :class="{'c-modal--active': showDeleteModal}">
        <div class="c-modal__overlay" @click="showDeleteModal = false"></div>
        <div class="c-modal__container">
            <div class="c-modal__header">
                <div class="c-modal__title-group">
                    <i class="fas fa-trash-alt c-modal__icon c-modal__icon--danger"></i>
                    <h3 class="c-modal__title">Hapus Kontak</h3>
                </div>
                <button class="c-modal__close" @click="showDeleteModal = false">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="c-modal__body">
                <div class="c-alert c-alert--warning">
                    <i class="fas fa-exclamation-triangle c-alert__icon"></i>
                    <div class="c-alert__content">
                        <p>Apakah Anda yakin ingin menghapus kontak <strong x-text="deleteContact.name"></strong>?</p>
                        <p>Tindakan ini tidak dapat dibatalkan.</p>
                    </div>
                </div>
                
                <div class="c-form-footer u-mt-6">
                    <button type="button" class="c-button c-button--secondary" @click="showDeleteModal = false">Batal</button>
                    <button type="button" class="c-button c-button--danger" @click="deleteContact">
                        <i class="fas fa-trash-alt"></i> Hapus
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
