<div id="dashboard-app" 
     x-data="dashboardApp()"
     x-init="init()"
     data-connection-state="{{.ConnectionState}}"
     data-command-count="{{.CommandCount}}"
     data-message-count="{{.MessageCount}}"
     data-commands-run="{{.CommandsRun}}"
     data-phone="{{.Phone}}"
     data-name="{{.Name}}"
     class="animate-fadeIn pb-24">
    
    <div class="content-wrapper">
        <div class="mb-8 flex flex-wrap justify-between items-center">
            <h1 class="text-2xl font-semibold text-white mb-4 sm:mb-0">Dashboard Overview</h1>
            <button @click="refreshStats" class="btn-action-primary" :disabled="isRefreshing">
                <span class="flex items-center">
                    <i class="fas fa-sync-alt mr-2" :class="{'animate-spin': isRefreshing}"></i>
                    <span>Refresh</span>
                </span>
            </button>
        </div>
        
        <!-- Tampilkan alert jika tidak terhubung -->
        <div x-show="connectionState !== 'connected'" class="animate-slideInUp">
            {{if ne .ConnectionState "connected"}}
            {{template "components/alert" dict "Type" "warning" "Message" "Bot tidak terhubung ke WhatsApp. Silakan scan QR code di halaman QR."}}
            {{end}}
        </div>
        
        <!-- Connected Account Info (only shown when connected) -->
        <div x-show="connectionState === 'connected'" class="glass border border-slate-700/30 rounded-xl p-5 mb-8 animate-slideInUp">
            <div class="flex items-center justify-between flex-wrap">
                <div class="flex items-center mb-2 sm:mb-0">
                    <div class="w-12 h-12 rounded-lg bg-primary-500/20 text-primary-400 flex items-center justify-center mr-4">
                        <i class="fas fa-user text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-white">Connected WhatsApp</h3>
                        <p class="text-slate-400" x-text="getDisplayPhone()"></p>
                    </div>
                </div>
                
                <div class="flex items-center">
                    <div x-data="{ status: connectionState }">
                        {{template "components/connection-status-badge" .}}
                    </div>
                    <a href="/qr" class="btn-action-secondary ml-4 py-2 px-3 text-sm">
                        <i class="fas fa-qrcode mr-2"></i>
                        <span>Manage Connection</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <!-- Connection Status Card -->
            {{template "components/status-card" dict 
                "StatusValue" "connectionState" 
                "SuccessValue" "connected" 
                "SuccessIcon" "fa-plug" 
                "FailureIcon" "fa-plug-circle-xmark" 
                "SuccessText" "Active" 
                "FailureText" "Offline" 
                "Label" "WhatsApp Status" 
                "SubtextExpression" "connectionState === 'connected' ? 'Connected for ' + formatDuration(uptime) : 'Disconnected'"
                "Delay" "0"
            }}

            <!-- Commands Card -->
            <div class="glass border border-slate-700/30 rounded-xl overflow-hidden animate-slideInUp" style="animation-delay: 100ms;">
                <div class="px-6 py-5">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg bg-primary-500/20 text-primary-400 flex items-center justify-center">
                            <i class="fas fa-terminal"></i>
                        </div>
                        <div class="mx-5">
                            <h4 class="text-2xl font-semibold text-white" x-text="commandCount"></h4>
                            <div class="text-slate-400">Total Commands</div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-3 bg-slate-800/50 border-t border-slate-700/30 text-center text-slate-300">
                    <span>Available Commands</span>
                </div>
            </div>

            <!-- Messages Card -->
            <div class="glass border border-slate-700/30 rounded-xl overflow-hidden animate-slideInUp" style="animation-delay: 200ms;">
                <div class="px-6 py-5">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-lg bg-yellow-500/20 text-yellow-400 flex items-center justify-center">
                            <i class="fas fa-message"></i>
                        </div>
                        <div class="mx-5">
                            <h4 class="text-2xl font-semibold text-white" x-text="messageCount"></h4>
                            <div class="text-slate-400">Messages Received</div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-3 bg-slate-800/50 border-t border-slate-700/30 text-center text-slate-300">
                    <span>Since Bot Started</span>
                </div>
            </div>
        </div>

        <!-- Command List -->
        <div class="glass border border-slate-700/30 rounded-xl animate-slideInUp" style="animation-delay: 300ms;">
            <div class="card-header">
                <h2 class="text-xl font-semibold text-white">Command List</h2>
                <span class="text-sm bg-primary-500/20 text-primary-300 px-2 py-1 rounded">
                    <i class="fas fa-terminal mr-1"></i>
                    <span x-text="commandCount"></span> Commands
                </span>
            </div>
            <div class="p-4 overflow-x-auto">
                <table class="min-w-full table">
                    <thead>
                        <tr>
                            <th class="rounded-l-lg w-1/4">Command</th>
                            <th class="rounded-r-lg">Description</th>
                        </tr>
                    </thead>
                    <tbody id="commands-list">
                        <template x-for="(cmd, name) in commands" :key="name">
                            <tr class="hover:bg-white/5">
                                <td class="border-b border-slate-700/30">
                                    <code class="bg-slate-700/30 text-primary-300 px-2 py-1 rounded font-mono"
                                          x-text="'!' + name"></code>
                                </td>
                                <td class="border-b border-slate-700/30 text-slate-300" 
                                    x-text="cmd.Description || 'No description available'"></td>
                            </tr>
                        </template>
                        <!-- Fallback for empty command list -->
                        <tr x-show="Object.keys(commands).length === 0">
                            <td colspan="2" class="text-center p-4 text-slate-400">
                                No commands available
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script type="application/json" id="commands-data">
        {{json .Commands}}
    </script>
</div>
